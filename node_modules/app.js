const express = require('express');
const bodyParser = require('body-parser');
const axios = require('axios');

const app = express();
const port = process.env.PORT || 7850;

app.use(bodyParser.json());

// Define the /convert endpoint
app.post('/convert', async (req, res) => {
  try {
    // Retrieve input data from the request body
    const { amount, from, to } = req.body;

    // Ensure that you have the required input data
    if (!amount || !from || !to || !Array.isArray(to)) {
      return res.status(400).json({ error: 'Invalid input data' });
    }

    // Define the API URL based on the base and target currencies
    const apiUrl = `https://cdn.isdelivr.net/gh/fawazahmed0/currency-api@1/latest/currencies/${from}/${to.join(',')}.json`;

    // Fetch exchange rates using axios
    const response = await axios.get(apiUrl);
    const exchangeRates = response.data;

    // Implement currency conversion logic here
    const conversions = [];
    for (const targetCurrency of to) {
      const rate = exchangeRates[targetCurrency];
      if (rate) {
        const convertedAmount = amount * rate;
        conversions.push({ to: targetCurrency, value: convertedAmount });
      } else {
        // Handle cases where the target currency is not supported
        conversions.push({ to: targetCurrency, value: 'Currency not supported' });
      }
    }

    // Return the conversion results in the response
    return res.json({ conversions });
  } catch (error) {
    console.error('Error fetching exchange rates:', error);
    return res.status(500).json({ error: 'Internal server error' });
  }
});

app.listen(port, () => {
  console.log(`API listening at http://localhost:${port}`);
});
